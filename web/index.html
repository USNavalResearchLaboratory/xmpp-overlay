<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>XOP Web Interface</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="./css/bootstrap.min.css" rel="stylesheet">
    <link href="./css/bootstrap-responsive.min.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
      section {
          padding-top:40px;
      }
    </style>

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>

  <body>

    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">XOP Web Interface</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="#muc">MUC Rooms</a></li>
              <li><a href="#server">Server Info</a></li>
              <li><a href="#indi">INDI Info</a></li>
              <li><a href="#indi">MUC Info</a></li>
              <li><a href="#about">About</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container">
    <div class="row">
        <div class="span10 offset1">
            <section id="muc">
                <h1>Available MUC Rooms</h1>
                <span id="mucrooms">Waiting for response...</span>
            </section>
        </div>
        <div class="span10 offset1">
            <section id="server">
                <h1>Server Information</h1>
                <p>These are the properties set in xop.properties</p>
                <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th class="span5">Property Name</th>
                        <th class="span5">Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>DOMAIN:</td><td><span class="query" data-resource="properties" data-query="xop.domain"></span></td></tr>
                    <tr><td>FORCE_PLAIN_AUTH:</td><td><span class="query" data-resource="properties" data-query="xop.debug.force.plain.auth"></span></td></tr>
                    <tr><td>BIND_INTERFACE:</td><td><span class="query" data-resource="properties" data-query="xop.bind.interface"></span></td></tr>
                    <tr><td>DISCOVERY_SYSTEM:</td><td><span class="query" data-resource="properties" data-query="Gump.Discovery"></span></td></tr>
                    <tr><td>ENABLED_COMPONENTS:</td><td><span class="query" data-resource="properties" data-query="xop.enabled.components"></span></td></tr>
                    <tr><td>SAVE_PROPS_ON_CHANGE:</td><td><span class="query" data-resource="properties" data-query="xop.properties.saveOnChange"></span></td></tr>
                    <tr><td>CLIENT_REAP_MS:</td><td><span class="query" data-resource="properties" data-query="xop.client.connection.reap.period.ms"></span></td></tr>
                    <tr><td>COMPONENT_POLL_PERIOD:</td><td><span class="query" data-resource="properties" data-query="xop.component.autoload.poll.period.ms"></span></td></tr>
                    <tr><td>COMPONENT_DIR:</td><td><span class="query" data-resource="properties" data-query="xop.component.autoload.dir"></span></td></tr>
                    <tr><td>COMPONENT_AUTOLOAD:</td><td><span class="query" data-resource="properties" data-query="xop.component.autoload"></span></td></tr>
                    <tr><td>CONFIG_DIR:</td><td><span class="query" data-resource="properties" data-query="xop.config.dir"></span></td></tr>
                    <tr><td>CLIENT_AUTHENTICATION_PROVIDER:</td><td><span class="query" data-resource="properties" data-query="xop.client.authentication.provider"></span></td></tr>
                    <tr><td>PROPS_FILE_LOCATION:</td><td><span class="query" data-resource="properties" data-query="properties.file"></span></td></tr>
                    <tr><td>MULTICAST_TTL:</td><td><span class="query" data-resource="properties" data-query="xop.multicast.ttl"></span></td></tr>
                    <tr><td>PACKET_HANDLER_CORE_POOL_SIZE:</td><td><span class="query" data-resource="properties" data-query="xop.router.core.pool.size"></span></td></tr>
                    <tr><td>PACKET_HANDLER_MAX_POOL_SIZE:</td><td><span class="query" data-resource="properties" data-query="xop.router.max.pool.size"></span></td></tr>
                    <tr><td>PACKET_HANDLER_KEEP_ALIVE_TIME:</td><td><span class="query" data-resource="properties" data-query="xop.router.keep.alive.time"></span></td></tr>
                    <tr><td>XOP_IQ_TIMEOUT:</td><td><span class="query" data-resource="properties" data-query="xop.router.iq.timeout"></span></td></tr>
                    <tr><td>PING_SUPPORTED:</td><td><span class="query" data-resource="properties" data-query="xop.ping.supported"></span></td></tr>
                </tbody>
                </table>
            </section>
        </div>
    <!--
     -mode(reactive, oppcache or proactive): Lifetime (TTL) of the service
     - ttl(long): Lifetime (TTL) of the service (All times are in milliseconds)
     - rai(long): Service proactive readvertisement interval for sending advertisements
     - numra(int): Number of times to readvertise the service (-1 = forever)
     - cqi(comma seperated list of longs): Times a client queries for a service e.g. 0,100,200
     - sci(long): Proactive service cancel notification interval
     - numscm(int): Number of times to send proactive service cancellations
    -->
        <div class="span10 offset1">
            <section id="indi">
                <h1>INDI configurations</h1>
                <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th class="span5">Property Name</th>
                        <th class="span5">Value</th>
                    </tr>
                </thead>
                <tbody>

                    <tr><td>INDI_TTL:</td><td><span class="query" data-resource="properties" data-query="xop.sds.indi.ttl"></span></td></tr>
                    <tr><td>INDI_RAI:</td><td><span class="query" data-resource="properties" data-query="xop.sds.indi.rai"></span></td></tr>
                    <tr><td>INDI_NUMRA:</td><td><span class="query" data-resource="properties" data-query="xop.sds.indi.numra"></span></td></tr>
                    <tr><td>INDI_CQI:</td><td><span class="query" data-resource="properties" data-query="xop.sds.indi.cqi"></span></td></tr>
                    <tr><td>INDI_SCI:</td><td><span class="query" data-resource="properties" data-query="xop.sds.indi.sci"></span></td></tr>
                    <tr><td>INDI_NUMSCM:</td><td><span class="query" data-resource="properties" data-query="xop.sds.indi.numscm"></span></td></tr>
                </tbody>
                </table>
            </section>
        </div>
        <div class="span10 offset1">
            <section id="mucprop">
                <h2>MUC properties</h2>
                <table class="table table-striped table-bordered">
                <thead>
                    <tr>
                        <th class="span5">Property Name</th>
                        <th class="span5">Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>MUC_PORT:</td><td><span class="query" data-resource="properties" data-query="xop.muc.port"></span></td></tr>
                </tbody>
                </table>
            </section>
        </div>
    </div> <!-- /row -->
    <footer>
        <section id="about">
            <p class="pull-right"><a href="#">Back to top</a></p>
            <p>&copy; 2012 Drexel University</p>
        </section>
    </footer>

    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="./js/jquery.min.js"></script>
    <script>
        function xopQuery(resource, query, element) {
            $.getJSON("./" + resource + "?query=" + query, function(q) {
                $(element).html(q.result);
            })
            .error(function() { 
                $(element).html('<i>Request Failed</i>'); 
            });
        }

        function jq(myid) { 
            return '#' + myid.replace(/(:|\.)/g,'\\$1');
        }

        $(document).ready(function () {
            // Generic one-liner queries
            $(".query").each(function() {
                xopQuery($(this).attr("data-resource"), $(this).attr("data-query"), this);
            });
            // Complex queries
            $.getJSON("./muc?query=rooms", function(q) {
                var arr = q.result;
                var retval = ""
                for(var i=0;i<arr.length;i++){
                    var obj = arr[i];
                    for(var key in obj){
                        var attrName = key;
                        var attrValue = obj[key];
                        if (attrValue != "") {
                            retval += "<li>MUC: <a href=\"/chat?" + attrName + "=" + attrValue + "\">" + attrValue + "</a></li>";
                        }
                    }
                }
                if (retval == "") {
                    retval = "<i>There are no MUC rooms currently available</i>";
                } else {
                    retval = "<ul>" + retval + "</ul>";
                }
                $('#mucrooms').html(retval);
            })
            .error(function() { 
                $(element).html('<i>Request Failed</i>'); 
            });
        });
    </script> 

  </body>
</html>
