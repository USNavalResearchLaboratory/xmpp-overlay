<h1>Service Discovery Instances using the Web API</h1>

<p>This section covers the Web API methods for instantating a new service discovery
    instance or updating an existing one. The root URL for these commands is:</p>

<div class="blackbox">
    http://localhost/api/sds
</div>

<h2>1. Create an SDS</h2>
<div class="rounded nicebox" style="width: 900px;">
    <div class="floatleft blackbox">
        Command: <br>
        Verb: <br>
        Consumes: <br>
        Produces:<br>
    </div>

    <div class="floatleft blackbox">
        api/sds/create<br>
        POST  <br>
        application/json, application/xml<br>
        application/json, application/xml<br>
    </div>

    <div class="verticalspace"></div>

    <div class="floatleft whitebox" style="width: 430px">
        The create command creates a discovery system based on the specification provided in
        the payload of the message.  The service discovery system details can be specified using
        JSON or XML.

    </div>
    <div class="clear"></div>
</div>

        <br>

        <p> A service discovery system can be created by sending (POSTing) an XML or JSON payload
        to the "create" URL. The message has three levels of key/value pairs, depending on
        the type of discovery system you want to create:</p>
        <ol>
            <li><b>High Level Parameters:</b> allow the specification of the discovery system name
                and id (optional), the service types it searhes for and the operating mode (consumer,
            producer, or both).</li>
            <li><b>Discovery System General Parameters: provide operational parameters, such as
            logging, the specification of which discovery system you would like to use (JMDNS or INDI)
            and what network interface the discovery system should be run on.  There are also high
                level options, like whether you would like .services files to be generated (containing
            discovered services) or whether you want the even generation system to be enable to collected
            statistics from the run.</b></li>
            <li><b>INDI Parameters: thee allow the setting of INDI-specific parameters. A description of
                these parameters can be found in the "User Manual" -> "INDI" section of this documentation.</b></li>
        </ol>

        <p>An example in XML of a service description is:
<pre class="brush: xml;">
<protoSDInstance>
    <Discovery_System_Name>PROTOSD-INSTANCE-1</Discovery_System_Name>
    <Discovery_System_ID>1</Discovery_System_ID>
    <Service_Types>_http._tcp.local.</Service_Types>
    <Operating_Mode>[CONSUMER]</Operating_Mode>
    <Discovery_System_Parameters>
        <Logging_Level>SEVERE</Logging_Level>
        <Service_Discovery_System>INDI</Service_Discovery_System>
        <Network_Interface>en0</Network_Interface>
        <Events_Generated>false</Events_Generated>
        <Service_Files>true</Service_Files>
        <INDI_Parameters>
            <INDI_Mode>Reactive</INDI_Mode>
            <Client_Query_Interval>0 100 200 400 800 1600</Client_Query_Interval>
            <Advert_Time_To_Live>3600000</Advert_Time_To_Live>
            <Readvertisement_Interval>1800000</Readvertisement_Interval>
            <Number_Of_Readvertisements>0</Number_Of_Readvertisements>
            <Service_Cancel_Interval>1000</Service_Cancel_Interval>
            <Number_Of_Service_Cancel_Messages>-1</Number_Of_Service_Cancel_Messages>
            <mDNS_Port>5353</mDNS_Port>
            <Record_Reaper_Interval>500</Record_Reaper_Interval>
            <Allow_Duplicate_Adverts>false</Allow_Duplicate_Adverts>
            <Network_Loopback>true</Network_Loopback>
            <Unicast_Server_Replies>true</Unicast_Server_Replies>
        </INDI_Parameters>
    </Discovery_System_Parameters>
</protoSDInstance>
</pre>

<p>And the same payload specified in JSON would be:</p>

<pre class="brush: jscript;">
{"proto_sd_instances":
    {
    "Discovery_System_Name":"PROTOSD-INSTANCE-1",
    "Discovery_System_ID":"1",
    "Service_Types":"_http._tcp.local.",
    "Operating_Mode":"[CONSUMER]"
    "Discovery_System_Parameters":{
        "Logging_Level":"SEVERE",
        "Service_Discovery_System":"INDI",
        "Network_Interface":"en0",
        "Events_Generated":"false",
        "Service_Files":"true",
        "INDI_Parameters":{
            "INDI_Mode":"Reactive",
            "Client_Query_Interval":"0 100 200 400 800 1600",
            "Advert_Time_To_Live":"3600000",
            "Readvertisement_Interval":"1800000",
            "Number_Of_Readvertisements":"0",
            "Service_Cancel_Interval":"1000",
            "Number_Of_Service_Cancel_Messages":"-1",
            "mDNS_Port":"5353",
            "Record_Reaper_Interval":"500",
            "Allow_Duplicate_Adverts":"false",
            "Network_Loopback":"true",
            "Unicast_Server_Replies":"true"
            }
        }
    }
}
</pre>

<h2>2. Update an SDS</h2>
<div class="rounded nicebox" style="width: 900px;">
    <div class="floatleft blackbox">
        Command: <br>
        Verb: <br>
        Consumes: <br>
        Produces:<br>
    </div>

    <div class="floatleft blackbox">
        api/sds/update<br>
        PUT  <br>
        application/json, application/xml<br>
        application/json, application/xml<br>
    </div>

    <div class="verticalspace"></div>

    <div class="floatleft whitebox" style="width: 430px">
        The update command updates an existing discovery system based on the specification provided in
        the payload of the message.  The service discovery system details can be specified using
        JSON or XML.

    </div>
    <div class="clear"></div>
</div>
<br>

        <p>Any service discovery instance can be updated at any time. Th application i.e. client should stored
            representations of instances that it has created (using XML or JSON) and then generate updates to
        these for updating the service discovery system.   The "Discovery_System_ID" and the
            "Discovery_System_Name" must match an existing SDS instance currently in use by the server.
        </p>

        <p>An update follows exactly the same message format as above except that the information is
        PUT to the update URL, not POST'ed.</p>


<h2>3. List all SDS systems </h2>
<div class="rounded nicebox" style="width: 900px;">
    <div class="floatleft blackbox">
        Command: <br>
        Verb: <br>
        Consumes: <br>
        Produces:<br>
    </div>

    <div class="floatleft blackbox">
        api/sds <br>
        GET  <br>
        none <br>
        application/json, application/xml<br>
    </div>

    <div class="verticalspace"></div>

    <div class="floatleft whitebox" style="width: 430px">
        A GET on the base sds url returns a list of the current SDS systems instantiated on this
        server. This provides a high level view, showing only the name, ID and operating mode.
    </div>
    <div class="clear"></div>
</div>
<br>

<p>This command gets the list of ProtoSD instances and an example of the output XML is:

<pre class="brush: xml;">
<protoSDList>
    <proto_sd_instances>
        <Discovery_System_Name>PROTOSD-INSTANCE-1</Discovery_System_Name>
        <Discovery_System_ID>1</Discovery_System_ID>
        <Operating_Mode>[CONSUMER]</Operating_Mode>
    </proto_sd_instances>
 </protoSDList>
</pre>

<p>The actual return type is determined by setting the "Accept" field in the HTTP header to specify what
you are prepared to accept as a return value.</p>


<h2>4. List details of all SDS systems </h2>
<div class="rounded nicebox" style="width: 900px;">
    <div class="floatleft blackbox">
        Command: <br>
        Verb: <br>
        Consumes: <br>
        Produces:<br>
    </div>

    <div class="floatleft blackbox">
        api/sds/detail <br>
        GET  <br>
        none <br>
        application/json, application/xml<br>
    </div>

    <div class="verticalspace"></div>

    <div class="floatleft whitebox" style="width: 430px">
        A GET on the base sds/detail url returns a detailed list of the current SDS systems instantiated on this
        server. This option provides a detailed view, showing all options.
    </div>
    <div class="clear"></div>
</div>
<br>

<p>An example of the output XML is:

<pre class="brush: xml;">
<protoSDDetailedList>
    <proto_sd_instances>
        <Discovery_System_Name>PROTOSD-INSTANCE-1</Discovery_System_Name>
        <Discovery_System_ID>1</Discovery_System_ID>
        <Service_Types>_http._tcp.local.</Service_Types>
        <Operating_Mode>[CONSUMER]</Operating_Mode>
        <Discovery_System_Parameters>
            <Logging_Level>SEVERE</Logging_Level>
            <Service_Discovery_System>INDI</Service_Discovery_System>
            <Network_Interface>en0</Network_Interface>
            <Events_Generated>false</Events_Generated>
            <Service_Files>true</Service_Files>
            <INDI_Parameters>
                <INDI_Mode>Reactive</INDI_Mode>
                <Client_Query_Interval>0 100 200 400 800 1600</Client_Query_Interval>
                <Advert_Time_To_Live>3600000</Advert_Time_To_Live>
                <Readvertisement_Interval>1800000</Readvertisement_Interval>
                <Number_Of_Readvertisements>0</Number_Of_Readvertisements>
                <Service_Cancel_Interval>1000</Service_Cancel_Interval>
                <Number_Of_Service_Cancel_Messages>-1</Number_Of_Service_Cancel_Messages>
                <mDNS_Port>5353</mDNS_Port>
                <Record_Reaper_Interval>500</Record_Reaper_Interval>
                <Allow_Duplicate_Adverts>false</Allow_Duplicate_Adverts>
                <Network_Loopback>true</Network_Loopback>
                <Unicast_Server_Replies>true</Unicast_Server_Replies>
            </INDI_Parameters>
        </Discovery_System_Parameters>
    </proto_sd_instances>
</protoSDDetailedList>
</pre>

<p>Again, the return type is determined by setting the "Accept" field in the HTTP header to XML or JSON.</p>


<h2>5.Get the detail of one SDS system </h2>
<div class="rounded nicebox" style="width: 900px;">
    <div class="floatleft blackbox">
        Command: <br>
        Parameters:<br>
        Verb: <br>
        Consumes: <br>
        Produces:<br>
    </div>

    <div class="floatleft blackbox">
        api/sds/id <br>
        {id} <br>
        GET <br>
        none <br>
        application/json, application/xml<br>
    </div>

    <div class="verticalspace"></div>

    <div class="floatleft whitebox" style="width: 430px">
        A GET on the base sds/id by passing the ID of the specific discovery system, returns a detailed
        output of that SDS system.
    </div>
    <div class="clear"></div>
</div>
<br>

<p>This command allows you to retrieve details of a particular discovery system. It will return
XML or JSON depending on the value of the "accept" field in the HTTP header. The ID parameter can
be passed as a query string as part of the URL or can be appended to the URL directly. For example:
</p>

<pre class="brush: xml;">
http://localhost/api/sds?id=1
</pre>

And

<pre class="brush: xml;">
http://localhost/api/sds/1
</pre>

<p>Will both provide the required result.

