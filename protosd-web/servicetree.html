<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="keywords" content="NRL, Service Discovery" />
    <title>mDNS Tree Browser</title>

    <link rel="stylesheet" href="/css/protosd.css" type="text/css" />

    <script type="text/javascript" src="/js/jquery-1.6.2.js"></script>
    <script type="text/javascript" src="/js/jquery.jstree.js"></script>
    <script type="text/javascript" src="/js/jquery.cookie.js"></script>
    <script type="text/javascript" src="/js/jquery.hotkeys.js"></script>
    <script type="text/javascript" src="/js/jquery.form.js"></script>
    <script type="text/javascript" src="/js/protosd.js"></script>

    <script type="text/javascript">

        var scans=0;
        var loadTime = null;
        var scaninterval=3000;

        var timingFunctionID = function () {
            if (loadTime==null) {
                loadTime = (new Date()).getTime();
            }

            var timeNow = (new Date()).getTime();

            var timeRunning = parseInt((timeNow-loadTime) / 1000); // ms -> sec

            var second = timeRunning % 60;
            var minute = parseInt(timeRunning / (60*60));
            var hour = parseInt(timeRunning / (60*60*60));

            $("#timecount").text("Running for : " + hour + ":" + minute + ":" + second);
        }

        var getServicesID = function() {
            getDataFromServer(false);
            scans++;
            $("#scancount").text("Scan Number: " + scans);

            timerID = setTimeout(getServicesID, scaninterval);
        }

        function getCurrentVariables() {
            var ret;
            $.ajax({
                url: "/ajax/jstree/options",
                type: 'get',
                dataType: 'json',
                async: false,
                success: function(data) {
                    ret= data;
                }
            });
            return ret;
        }

        function populateVariables(navs) {
            for (name in navs) {
                var value= navs[name];
                var id= '#' + name;

                if (value == "true")  {
                    $(id).attr('checked','checked')
                } else if (value == "false") {
                    $(id).removeAttr('checked')
                } else {
                    $(id).val(value);
                }
            }
        }

        $(document).ready(function() {
            $('.sdsdetails').load('/ajax/sds/current');

            populateVariables(getCurrentVariables());

            $("#tree-options-form").submit(function(event) {

                /* stop form from submitting normally */
                event.preventDefault();

                var values = $('#tree-options-form').serialize();

                url = "/ajax/jstree/options";

                /* Send the data using post and put the results in a div */
                $.post( url, values,
                        function( data ) {
                            getDataFromServer(false);
                        }
                );
            });

            timingFunctionID = setInterval(timingFunctionID, 1000);

            $("#scanningdir").html("Scanning: " +  scaninterval + "ms");
            $("#scancount").text("Scan Number: " + scans);

            $("input").keyup(function () {
                var newInterval = parseInt($(this).val());

                if ( (isNaN(newInterval) == false) && (newInterval>99) ) {
                    scaninterval = newInterval;
                    $("#scanningdir").html("Scanning: " +  scaninterval + "ms");
                } else {
                    //   if (isNaN(newInterval) == true)
                    //     alert("Sorry, only integer values are allowed.  You must specify the interval in milliseconds (>99ms)");
                }
            }).keyup();

            timerID = setTimeout(getServicesID, scaninterval);


        });
    </script>

</head>

<body>

<div class="container">
    <div id="treewrapper">
        <div class="toptree">

            <form id="tree-options-form" action="">
                <div style="width:110px; height:100px; float: left; padding:0">
                    <a href="/index.html"><img src="/icons/dashboard.png" width="110px" height="100px"></a>
                </div>

                <div class="rounded column">
                    <label for="search">Search Services</label>
                    <input type="text" value="" style="width: 150px" title="Search" name="search" id="search" />

                    <label>Arrange By&nbsp; &nbsp; &nbsp; </label>
                    <select id="view" name="view" style="width: 150px;">
                        <option value="SERVICE_TYPE">Service Type</option>
                        <option selected="selected" value="HOST">Host</option>
                        <option value="SERVICE_NAME">Service Name</option>
                        <option value="PORT">Port Number</option>
                        <option value="DOMAIN">Domain</option>
                        <option value="SERVICE_ADDRESS">Service Address</option>
                        <option value="NET_INTERFACE_NAME">Net Interface Name</option>
                    </select>
                </div>

                <div class="rounded column">
                    <boollabel>Sort Items?</boollabel>
                    <input name="sort" id="sort" type="checkbox" checked/><br>
                    <div class="padding-below"></div>
                    <boollabel>Open Branches?</boollabel>
                    <input name="open" id="open" type="checkbox" checked />
                </div>

                <div class="rounded column" style="width: 220px;">
                    <div class="padding-below" id="intervalset">Scan Interval (ms):<input type="text" size = "6" value="3000" id="scantextinput" />
                    </div>
                    <div class="padding-below" id="scancount">
                    </div>
                    <div class="padding-below" id="timecount">
                    </div>
                </div>

                <div style="width: 90px; height:90px; float: left">
                    <input class="updatebutton" type="submit" name="submit" value="" />
                </div>

                <div class="clear"></div>
            </form>
        </div>

        <h2 class="treeheading"><span class="sdsdetails"></span>: Services</h2>

        <div class="bottomtree" >
            <div id="tree-space" class="demo">

            </div>

        </div>
        <div class="clear"></div>
    </div>
</div>


<div id="mytree" class="demo">

</div>

<div id="ajaxError"></div>

</body>
</html>

