<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="language" content="en" />

<title>Service Browser</title>

<link rel="stylesheet" type="text/css" href="/css/browser.css" />
<link rel="stylesheet" type="text/css" href="/css/lists.css">


<!--<style type="text/css"> body { font-size: 85%; } </style>-->


<script type="text/javascript" src="/js/jquery-1.6.2.js"></script>
<script type="text/javascript" src="/js/jquery.layout1.3.js"></script>
<script type="text/javascript" src="/js/jquery.form.js"></script>

<script type="text/javascript">
var outerLayout;
var debug=false;

var scans=0;
var loadTime = null;
var scaninterval=10000;
var baseDir;
var timerID=null;
var timingFunctionID=null;

var currentSelectedHostDiv=null;
var currentSelectedHostColor=null;
var currentSelectedServiceDiv=null;
var currentSelectedServiceColor=null;

var timingFunctionID = function () {
    if (loadTime==null) {
        loadTime = (new Date()).getTime();
    }

    var timeNow = (new Date()).getTime();

    var timeRunning = parseInt((timeNow-loadTime) / 1000); // ms -> sec

    var second = timeRunning % 60;
    var minute = parseInt(timeRunning / (60*60));
    var hour = parseInt(timeRunning / (60*60*60));

    $("#timecount").text("Running for : " + hour + ":" + minute + ":" + second);
}

var getServicesID = function() {
    $.getJSON("service/scan", function(data) {

        if (data.error != null) {
            $('#log').html(data.error);
        }
        baseDir = data.basedir;

        $("#scanningdir").html("Scanning \".services\" Files in Directory \"" + baseDir + "\" every " +  scaninterval + "ms");

        var currentServices = $("#servicelist").html();

        $("#servicelist").html(data.services);
        $("#hostlist").html(data.hosts);
        $("#detailslist").html(data.details);

        if (currentSelectedHostDiv!=null) {
            var host = "#" + currentSelectedHostDiv.attr("id");
            var servicesForHosts = host + "-show";
            $(servicesForHosts).show();
            $(host).css('background-color', '#58B8E5')
        }

        if (currentSelectedServiceDiv!=null) {
            var service = "#" + currentSelectedServiceDiv.attr("id");
            var serviceDetail = service + "-show";
            $(serviceDetail).show();
            $(service).css('background-color', '#58B8E5')
        }


        if (debug) {
            var deb = "Hosts: " + data.hosts+ "Services: " + data.services + "\nDetails:" + data.details;
            $("#debuginfo").text(deb);
        }

        scans++;
        $("#scancount").text("Scan Number: " + scans);

        timerID = setTimeout(getServicesID, scaninterval);
    })
}

function setCurrentService(serviceDiv) {
    if (currentSelectedServiceDiv !=null) {
        currentSelectedServiceDiv.css('background-color', "#222")
        var id = "#" + currentSelectedServiceDiv.attr("id") + "-show";
        $(id).hide();
    }

    var id = "#" + serviceDiv.attr("id") + "-show";
    $(id).show();

    currentSelectedServiceDiv=serviceDiv;
    currentSelectedServiceColor=serviceDiv.css('background-color');

    serviceDiv.css('background-color', '#58B8E5');
}

function setCurrentHost(hostDiv) {
    if (currentSelectedHostDiv !=null) {
        currentSelectedHostDiv.css('background-color', "#222")
        var id = "#" + currentSelectedHostDiv.attr("id") + "-show";
        $(id).hide();
    }

    var id = "#" + hostDiv.attr("id") + "-show";
    $(id).show();

    currentSelectedHostDiv=hostDiv;
    currentSelectedHostColor=hostDiv.css('background-color');

    hostDiv.css('background-color', '#58B8E5');
}

/*
 *#######################
 *     ON PAGE LOAD
 *#######################
 */
$(document).ready( function() {

    $("#servicelist").html("Please wait, loading services...");

    // create the OUTER LAYOUT
    outerLayout = $("body").layout( layoutSettings_Outer );

    /*******************************
     ***  CUSTOM LAYOUT BUTTONS  ***
     *******************************
     *
     * Add SPANs to the east/west panes for customer "close" and "pin" buttons
     *
     * COULD have hard-coded span, div, button, image, or any element to use as a 'button'...
     * ... but instead am adding SPANs via script - THEN attaching the layout-events to them
     *
     * CSS will size and position the spans, as well as set the background-images
     */

        // BIND events to hard-coded buttons in the NORTH toolbar
    outerLayout.addPinBtn( "#tbarPinWest", "west" );
    outerLayout.addPinBtn( "#tbarPinEast", "east" );

    // save selector strings to vars so we don't have to repeat it
    // must prefix paneClass with "body > " to target ONLY the outerLayout panes
    var westSelector = "body > .ui-layout-west"; // outer-west pane
    var eastSelector = "body > .ui-layout-east"; // outer-east pane
    var centerSelector = "body > .ui-layout-center"; // center pane

    // CREATE SPANs for pin-buttons - using a generic class as identifiers
    $("<span></span>").addClass("pin-button").prependTo( westSelector );
    $("<span></span>").addClass("pin-button").prependTo( eastSelector );
    // BIND events to pin-buttons to make them functional
    outerLayout.addPinBtn( westSelector +" .pin-button", "west");
    outerLayout.addPinBtn( eastSelector +" .pin-button", "east" );

    // CREATE SPANs for close-buttons - using unique IDs as identifiers
    $("<span></span>").attr("id", "west-closer" ).prependTo( westSelector );
    $("<span></span>").attr("id", "east-closer").prependTo( eastSelector );
    // BIND layout events to close-buttons to make them functional
    outerLayout.addCloseBtn("#west-closer", "west");
    outerLayout.addCloseBtn("#east-closer", "east");

    timingFunctionID = setInterval(timingFunctionID, 1000);
    timerID = setTimeout(getServicesID, 100);

    // setTimeout(, scanInterval);

    $("input").keyup(function () {
        var newInterval = parseInt($(this).val());

        if ( (isNaN(newInterval) == false) && (newInterval>99) ) {
            scaninterval = newInterval;
            $("#scanningdir").html("Scanning \".services\" Files in Directory \"" + baseDir + "\" every " +  scaninterval + "ms");
        } else {
         //   if (isNaN(newInterval) == true)
           //     alert("Sorry, only integer values are allowed.  You must specify the interval in milliseconds (>99ms)");
        }
    }).keyup();

    $("div.log").ajaxError(function(event, jqXHR, ajaxSettings, thrownError) {
        $("#servicelist").html("<p>ERROR:</p>")
        $error = "<ul>";
        $error += "<li> event:" +  event + "</li>";
        $error += "<li> jqXHR:" + jqXHR + "</li>";
        $error += "<li> Response That caused Error :" + jqXHR.responseText + "</li>";
        $error += "<li> ajaxSettings :" + ajaxSettings + "</li>";
        $error += "<li> Thrown Error :" + thrownError + "</li>";
        $error += "</ul>";
        $("div.log").html($error);
    });

    // Don't let hyperlinks from reloading page when a 'base.href' is set
    $("a").each(function () {
        var path = document.location.href;
        if (path.substr(path.length-1)=="#") path = path.substr(0,path.length-1);
        if (this.href.substr(this.href.length-1) == "#") this.href = path +"#";
    });

    $("#servicelist li").live("click", function(event) {
        setCurrentService($(this));
    });

    $("#hostchoice li").live( "click", function(event) {
        setCurrentHost($(this));
    });

});


// Layout Stuff for main container
var layoutSettings_Outer = {
    name: "outerLayout" // NO FUNCTIONAL USE, but could be used by custom code to 'identify' a layout
    // options.defaults apply to ALL PANES - but overridden by pane-specific settings
    ,	defaults: {
        size:					"auto"
        ,	minSize:				50
        ,	paneClass:				"pane" 		// default = 'ui-layout-pane'
        ,	resizerClass:			"resizer"	// default = 'ui-layout-resizer'
        ,	togglerClass:			"toggler"	// default = 'ui-layout-toggler'
        ,	buttonClass:			"button"	// default = 'ui-layout-button'
        ,	contentSelector:		".content"	// inner div to auto-size so only it scrolls, not the entire pane!
        ,	contentIgnoreSelector:	"span"		// 'paneSelector' for content to 'ignore' when measuring room for content
        ,	togglerLength_open:		35			// WIDTH of toggler on north/south edges - HEIGHT on east/west edges
        ,	togglerLength_closed:	35			// "100%" OR -1 = full height
        ,	hideTogglerOnSlide:		true		// hide the toggler when pane is 'slid open'
        ,	togglerTip_open:		"Close This Pane"
        ,	togglerTip_closed:		"Open This Pane"
        ,	resizerTip:				"Resize This Pane"
        //	effect defaults - overridden on some panes
        ,	fxName:					"slide"		// none, slide, drop, scale
        ,	fxSpeed_open:			750
        ,	fxSpeed_close:			1500
        ,	fxSettings_open:		{ easing: "easeInQuint" }
        ,	fxSettings_close:		{ easing: "easeOutQuint" }
    }
    ,	north: {
            size:					120,
        spacing_open:			1			// cosmetic spacing
        ,	togglerLength_open:		0			// HIDE the toggler button
        ,	togglerLength_closed:	-1			// "100%" OR -1 = full width of pane
        ,	resizable: 				false
        ,	slidable:				false
        //	override default effect
        ,	fxName:					"none"
    }
    ,	west: {
        size:					200
        ,	spacing_closed:			21			// wider space when closed
        ,	togglerLength_closed:	21			// make toggler 'square' - 21x21
        ,	togglerAlign_closed:	"top"		// align to top of resizer
        ,	togglerLength_open:		0			// NONE - using custom togglers INSIDE west-pane
        ,	togglerTip_open:		"Close West Pane"
        ,	togglerTip_closed:		"Open West Pane"
        ,	resizerTip_open:		"Resize West Pane"
        ,	slideTrigger_open:		"click" 	// default
        ,	initClosed:				false
        //	add 'bounce' option to default 'slide' effect
        ,	fxSettings_open:		{ easing: "easeOutBounce" }
    }
    ,	east: {
        size:					400
        ,	spacing_closed:			21			// wider space when closed
        ,	togglerLength_closed:	21			// make toggler 'square' - 21x21
        ,	togglerAlign_closed:	"top"		// align to top of resizer
        ,	togglerLength_open:		0 			// NONE - using custom togglers INSIDE east-pane
        ,	togglerTip_open:		"Close East Pane"
        ,	togglerTip_closed:		"Open East Pane"
        ,	resizerTip_open:		"Resize East Pane"
        ,	slideTrigger_open:		"click"
        ,	initClosed:				false
        //	override default effect, speed, and settings
        ,	fxName:					"drop"
        ,	fxSpeed:				"normal"
        ,	fxSettings:				{ easing: "easeOutBounce" } // nullify default easing
    }
    ,	center: {
        paneSelector:			"#mainContent" 			// sample: use an ID to select pane instead of a class
        ,	onresize:				"innerLayout.resizeAll"	// resize INNER LAYOUT when center pane resizes
        ,	minWidth:				200
        ,	minHeight:				200
    }
};

</script>

</head>
<body>



     <div class="ui-layout-north">
    <div class="header">mDNS Service Browser</div>

    <div class="floatleft" style="width: 100px">
        <a href="/index.html"><img src="/icons/dashboard.png" width="100px"></a>
    </div>

     <div style="position: absolute; left: 180px; top : 30px">

        <div class="content" style="align: auto">
            <div id="scanningdir">Dynamic content :)</div>
        </div>
        <ul class="toolbar" style="align: auto">
            <li id="tbarPinWest"><span></span>Show/Hide HOSTS</li>
            <li id="tbarPinEast"><span></span>Show/Hide Detail</li>
            <li id="intervalset">Scan Interval (ms):<input type="text" size = "6" value="10000" id="scantextinput" /></li>
            <li id="scancount"></li>
            <li id="timecount" class="last"></li>
        </ul>
     </div>
     </div>



<div class="ui-layout-west">

    <div class="header">HOSTS</div>
    <div class="content">

        <div id="hostlist"></div>
    </div>

    <div class="footer">List of Hosts Discovered</div>

</div>


<div id="mainContent">
    <div class="header">SERVICES</div>

    <div class="content">

        <div id="servicelist">

        </div>

        <div id="debuginfo">

        </div>


        <div class="log">

        </div>

    </div>

    <div class="footer">List of Services Discovered</div>
</div>

<div class="ui-layout-east">

    <div class="header">DETAIL</div>

    <div class="content">
        <div id="detailslist">

        </div>
    </div>

    <div class="footer">Full Service Details</div>

</div>

</body>
</html> 